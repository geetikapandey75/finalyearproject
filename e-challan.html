<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>E-Challan Services</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-blue-50 font-sans text-gray-900">

  <!-- Navigation -->
  <header class="bg-blue-900 text-white p-4">
    <div class="container mx-auto flex justify-between items-center">
      <h1 class="text-xl font-bold">Legal Assist</h1>
      <nav class="space-x-4">
        <a href="police-complaint.html" class="hover:underline">Home</a>
        <a href="vehicle.html" class="hover:underline">Unclaimed Vehicles</a>
        <a href="passport.html" class="hover:underline">Passport Services</a>
        <a href="e-challan.html" class="hover:underline font-semibold text-yellow-300">E-Challan</a>
      </nav>
    </div>
  </header>

  <!-- Hero Section -->
  <section class="text-center py-16 bg-gradient-to-r from-blue-800 to-blue-600 text-white">
    <h2 class="text-4xl font-bold mb-4">E-Challan Services</h2>
    <p class="mb-6 text-lg max-w-2xl mx-auto">
      Check, pay, or raise queries for your traffic challans online ‚Äî fast, simple, and secure.
    </p>
    <a href="#check" class="bg-yellow-400 text-black px-6 py-3 rounded-lg font-semibold hover:bg-yellow-300">Check Challan</a>
  </section>

  <!-- Main Content -->
  <main class="container mx-auto px-6 py-12 space-y-12">

    <!-- About -->
    <section class="bg-white rounded-xl shadow-lg p-8">
      <h3 class="text-2xl font-bold mb-4">About E-Challan</h3>
      <p class="text-gray-700 leading-relaxed">
        The E-Challan system is an initiative by the traffic police to ensure transparency and convenience in managing 
        traffic violations. It allows citizens to check and pay their pending challans online without visiting the RTO or police stations.
      </p>
    </section>

    <section id="check" class="bg-white rounded-xl shadow-lg p-8">
  <h3 class="text-2xl font-bold mb-6 text-center">Check Your Challan</h3>
  
<form method="POST" action="echallan.php" class="space-y-6 max-w-xl mx-auto">
    <div>
      <label class="block font-semibold mb-2">Vehicle Number</label>
      <input
        type="text"
        id="vehicleNo"
        name="vehicle_no"
        class="w-full p-4 border rounded-lg"
        placeholder="e.g., TS09AB1234"
        required
      >
    </div>

    <div>
      <label class="block font-semibold mb-2">Challan Number (if available)</label>
      <input
        type="text"
        id="challanNo"
        name="challan_no"
        class="w-full p-4 border rounded-lg"
        placeholder="Enter Challan Number (optional)"
      >
    </div>

    <button
      type="submit"
      class="bg-blue-700 text-white px-8 py-4 rounded-lg font-semibold hover:bg-blue-600 w-full"
    >
      Check Status
    </button>
  </form>
</section>

<script>
// JS to handle form submission without reloading page


  const vehicle = document.getElementById("vehicleNo").value.trim();
  const challan = document.getElementById("challanNo").value.trim();

  if (!vehicle && !challan) {
    alert("Enter Vehicle Number or Challan Number");
    return;
  }

  fetch(`api/api.php?action=check_challan&vehicle=${vehicle}&challan=${challan}`)
    .then(res => res.json())
    .then(data => {
      if (data.status === "not_found") {
        alert("No challan found for this vehicle/challan number.");
        return;
      }

      // Populate the result UI
      document.getElementById("resVehicle").textContent = data.vehicle_no;
      document.getElementById("resViolation").textContent = data.violation;
      document.getElementById("resDate").textContent = data.challan_date;
      document.getElementById("resAmount").textContent = data.amount;

      selectedChallanId = data.id; // save for payment
      document.getElementById("resultBox").classList.remove("hidden");
    })
    .catch(err => console.error(err));
;
</script>


    <!-- Payment Section -->
    <section class="bg-white rounded-xl shadow-lg p-8">
      <h3 class="text-2xl font-bold mb-4">How to Pay Your Challan</h3>
      <ol class="list-decimal list-inside space-y-2 text-gray-700">
        <li>Visit the official <a href="https://echallan.parivahan.gov.in/" target="_blank" class="text-blue-600 hover:underline">E-Challan Parivahan</a> website.</li>
        <li>Enter your vehicle number or challan ID.</li>
        <li>Review the violation details and total fine.</li>
        <li>Select your preferred online payment method (UPI / Debit Card / Net Banking).</li>
        <li>Download the payment receipt for future reference.</li>
      </ol>
    </section>

   
<script>
// JS to handle query form submission
document.getElementById("queryForm").addEventListener("submit", function(e) {
  e.preventDefault(); // prevent page reload

  const formData = new FormData(this);

  fetch("api/api.php?action=raise_query", {
    method: "POST",
    body: formData
  })
  .then(res => res.json())
  .then(data => {
    if (data.status === "submitted") {
      alert("Your query has been submitted successfully!");
      document.getElementById("queryForm").reset();
    } else if (data.error) {
      alert("Error: " + data.error);
    }
  })
  .catch(err => console.error(err));
});
</script>


<script>
  // Demo data (you can replace this with API later)
  const challanData = {
    "TS09AB1234": {
      violation: "Signal Jumping",
      amount: 1200,
      date: "2025-01-12"
    },
    "TS08ER9988": {
      violation: "No Helmet",
      amount: 500,
      date: "2025-01-05"
    }
  };

  const searchBtn = document.getElementById("searchBtn");
  const searchVehicle = document.getElementById("searchVehicle");

  const resultBox = document.getElementById("resultBox");
  const resVehicle = document.getElementById("resVehicle");
  const resViolation = document.getElementById("resViolation");
  const resDate = document.getElementById("resDate");
  const resAmount = document.getElementById("resAmount");

  const paymentModal = document.getElementById("paymentModal");
  const payBtn = document.getElementById("payBtn");
  const payAmount = document.getElementById("payAmount");
  const payAmountBtn = document.getElementById("payAmountBtn");
  const paymentMethod = document.getElementById("paymentMethod");
  const confirmPayment = document.getElementById("confirmPayment");
  const cancelPayment = document.getElementById("cancelPayment");

  const receiptBox = document.getElementById("receiptBox");
  const recVehicle = document.getElementById("recVehicle");
  const recAmount = document.getElementById("recAmount");
  const recMode = document.getElementById("recMode");
  const recDate = document.getElementById("recDate");

  let selectedVehicle = "";
  let selectedAmount = 0;

  // SEARCH CHALLAN
  searchBtn.addEventListener("click", () => {
    const vehicle = searchVehicle.value.trim().toUpperCase();

    if (vehicle === "") {
      alert("Enter a vehicle number");
      return;
    }

    if (challanData[vehicle]) {
      selectedVehicle = vehicle;
      selectedAmount = challanData[vehicle].amount;

      resVehicle.textContent = vehicle;
      resViolation.textContent = challanData[vehicle].violation;
      resDate.textContent = challanData[vehicle].date;
      resAmount.textContent = challanData[vehicle].amount;

      resultBox.classList.remove("hidden");
    } else {
      alert("No challan found for this vehicle.");
    }
  });

  // OPEN PAYMENT MODAL
  document.addEventListener("click", (e) => {
    if (e.target.id === "payBtn") {
      paymentModal.classList.remove("hidden");
      payAmount.textContent = selectedAmount;
      payAmountBtn.textContent = selectedAmount;
    }
  });

  // CANCEL PAYMENT
  cancelPayment.addEventListener("click", () => {
    paymentModal.classList.add("hidden");
  });

  // CONFIRM PAYMENT
  confirmPayment.addEventListener("click", () => {
    if (paymentMethod.value === "") {
      alert("Please select a payment method");
      return;
    }

    paymentModal.classList.add("hidden");

    recVehicle.textContent = selectedVehicle;
    recAmount.textContent = selectedAmount;
    recMode.textContent = paymentMethod.value;
    recDate.textContent = new Date().toLocaleString();

    receiptBox.classList.remove("hidden");
    window.scrollTo(0, receiptBox.offsetTop);
  });
</script>

<!-- Search & View Challans -->
<section id="search-challan" class="bg-white rounded-xl shadow-lg p-8">
  <h3 class="text-2xl font-bold mb-6 text-center">Search & View Challans</h3>

  <div class="space-y-4 max-w-xl mx-auto">
    <div>
      <label class="block font-semibold mb-1">Vehicle Number</label>
      <input type="text" id="vehicle" class="w-full p-3 border rounded-lg" placeholder="Enter Vehicle Number">
    </div>
    <div>
      <label class="block font-semibold mb-1">Challan Number</label>
      <input type="text" id="challan" class="w-full p-3 border rounded-lg" placeholder="Enter Challan Number">
    </div>
    <div>
      <label class="block font-semibold mb-1">License Number</label>
      <input type="text" id="license" class="w-full p-3 border rounded-lg" placeholder="Enter License Number">
    </div>
    <div>
      <label class="block font-semibold mb-1">Filter by Status</label>
      <select id="status" class="w-full p-3 border rounded-lg">
        <option value="">All</option>
        <option value="Paid">Paid</option>
        <option value="Unpaid">Unpaid</option>
      </select>
    </div>
    <div>
      <label class="block font-semibold mb-1">Violation Type</label>
      <select id="violation" class="w-full p-3 border rounded-lg">
        <option value="">All</option>
        <option value="No Helmet">No Helmet</option>
        <option value="Triple Riding">Triple Riding</option>
        <option value="Signal Jump">Signal Jump</option>
        <option value="Overspeeding">Overspeeding</option>
        <option value="Wrong Parking">Wrong Parking</option>
      </select>
    </div>
    <div class="flex gap-4">
      <div class="flex-1">
        <label class="block font-semibold mb-1">Date From</label>
        <input type="date" id="from" class="w-full p-3 border rounded-lg">
      </div>
      <div class="flex-1">
        <label class="block font-semibold mb-1">Date To</label>
        <input type="date" id="to" class="w-full p-3 border rounded-lg">
      </div>
    </div>

    <button id="searchBtn" class="bg-blue-700 text-white px-6 py-3 rounded-lg font-semibold w-full hover:bg-blue-600">
      Search Challans
    </button>
  </div>

  <div id="output" class="mt-6 max-w-xl mx-auto"></div>
</section>

<script>
const searchBtn = document.getElementById("searchBtn");

searchBtn.addEventListener("click", () => {
    const vehicle = document.getElementById("vehicle").value.trim().toUpperCase();
    const challan = document.getElementById("challan").value.trim().toUpperCase();
    const license = document.getElementById("license").value.trim().toUpperCase();
    const status = document.getElementById("status").value;
    const violation = document.getElementById("violation").value;
    const from = document.getElementById("from").value;
    const to = document.getElementById("to").value;

    if (!vehicle && !challan && !license) {
        alert("Enter at least one filter (Vehicle, Challan, or License)");
        return;
    }

    // Fetch from backend
    const params = new URLSearchParams({
        action: "search_challans",
        vehicle, challan, license, status, violation, from, to
    });

    fetch("api/api.php?" + params.toString())
    .then(res => res.json())
    .then(data => {
        displayResults(data);
    })
    .catch(err => {
        console.error(err);
        alert("Error fetching challans");
    });
});

function displayResults(challans) {
    const out = document.getElementById("output");
    out.innerHTML = "";

    if(!challans || challans.length === 0){
        out.innerHTML = `<div class="bg-gray-100 p-4 rounded-lg text-center">No challans found.</div>`;
        return;
    }

    challans.forEach(ch => {
        out.innerHTML += `
        <div class="bg-blue-50 p-4 rounded-lg mb-4 shadow-sm">
            <p><strong>Challan No:</strong> ${ch.challanNo}</p>
            <p><strong>Vehicle:</strong> ${ch.vehicle}</p>
            <p><strong>License:</strong> ${ch.license}</p>
            <p><strong>Violation:</strong> ${ch.violation}</p>
            <p><strong>Date:</strong> ${ch.date}</p>
            <p><strong>Amount:</strong> ‚Çπ${ch.amount}</p>
            <p><strong>Status:</strong> <span class="${ch.status==='Paid'?'text-green-600':'text-red-600'}">${ch.status}</span></p>
        </div>`;
    });
}
</script>

<script>
// Dummy challan data (replace with real API if available)
const challans = [
    { challanNo:"CH001", vehicle:"TS09AB1234", license:"DL09XY0001", violation:"No Helmet", date:"2025-01-05", amount:500, status:"Unpaid" },
    { challanNo:"CH002", vehicle:"TS09AB1234", license:"DL09XY0001", violation:"Signal Jump", date:"2025-01-15", amount:1000, status:"Paid" },
    { challanNo:"CH003", vehicle:"TS10CD7788", license:"DL55AB9001", violation:"Overspeeding", date:"2025-02-10", amount:1500, status:"Unpaid" },
    { challanNo:"CH004", vehicle:"TS10CD7788", license:"DL55AB9001", violation:"Wrong Parking", date:"2025-03-01", amount:200, status:"Paid" }
];

function searchChallans() {
    const v = document.getElementById("vehicle").value.trim().toUpperCase();
    const c = document.getElementById("challan").value.trim().toUpperCase();
    const l = document.getElementById("license").value.trim().toUpperCase();
    const status = document.getElementById("status").value;
    const violation = document.getElementById("violation").value;
    const from = document.getElementById("from").value;
    const to = document.getElementById("to").value;

    let result = challans.filter(ch => 
        (!v || ch.vehicle.includes(v)) &&
        (!c || ch.challanNo.includes(c)) &&
        (!l || ch.license.includes(l)) &&
        (!status || ch.status === status) &&
        (!violation || ch.violation === violation) &&
        (!from || ch.date >= from) &&
        (!to || ch.date <= to)
    );

    displayResults(result);
}

function displayResults(result) {
    const out = document.getElementById("output");
    out.innerHTML = "";

    if(result.length === 0) {
        out.innerHTML = `<div class="bg-gray-100 p-4 rounded-lg text-center">No challans found.</div>`;
        return;
    }

    result.forEach(ch => {
        out.innerHTML += `
        <div class="bg-blue-50 p-4 rounded-lg mb-4 shadow-sm">
            <p><strong>Challan No:</strong> ${ch.challanNo}</p>
            <p><strong>Vehicle:</strong> ${ch.vehicle}</p>
            <p><strong>License:</strong> ${ch.license}</p>
            <p><strong>Violation:</strong> ${ch.violation}</p>
            <p><strong>Date:</strong> ${ch.date}</p>
            <p><strong>Amount:</strong> ‚Çπ${ch.amount}</p>
            <p><strong>Status:</strong> <span class="${ch.status==='Paid'?'text-green-600':'text-red-600'}">${ch.status}</span></p>
        </div>`;
    });
}
</script>

<!-- Safe Driving Mini Game -->
<section class="bg-white rounded-xl shadow-lg p-6 mt-10 max-w-md mx-auto">
  <h3 class="text-xl font-bold text-center mb-4">üöó Safe Driving Challenge</h3>

  <p id="sdQuestion" class="text-center font-semibold mb-4"></p>

  <div id="sdOptions" class="space-y-2"></div>

  <p class="text-center text-gray-600 mt-4">Score: 
      <span id="sdScore" class="font-bold text-blue-700">0</span>
  </p>
</section>

<!-- Score Popup -->
<div id="sdPopup"
     class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden">
  <div class="bg-white p-6 rounded-xl max-w-sm w-full text-center shadow-lg">
    <h3 class="text-2xl font-bold mb-4">üèÜ Final Score</h3>
    <p id="sdFinalScore" class="text-xl font-semibold mb-4"></p>
    <button id="sdRestart" 
      class="bg-blue-700 text-white px-6 py-2 rounded-lg font-bold hover:bg-blue-600">
      Play Again
    </button>
  </div>
</div>

<!-- JS -->
<script>
// Questions
const sdQuestions = [
  {
    q: "You are feeling sleepy while driving. What should you do?",
    options: ["Drink water & continue", "Stop & rest", "Increase speed"],
    correct: 1
  },
  {
    q: "What is the safest following distance?",
    options: ["1 second", "3 seconds", "0.5 seconds"],
    correct: 1
  },
  {
    q: "You see a yellow signal. You should:",
    options: ["Accelerate", "Stop safely", "Ignore it"],
    correct: 1
  },
  {
    q: "Using mobile while driving is:",
    options: ["Okay at low speed", "Always dangerous", "Good for multitasking"],
    correct: 1
  },
  {
    q: "Seatbelts are:",
    options: ["Optional", "Only for highways", "Always required"],
    correct: 2
  }
];

let sdIndex = 0;
let sdScore = 0;

// DOM elements
const sdQuestion = document.getElementById("sdQuestion");
const sdOptions = document.getElementById("sdOptions");
const sdScoreDisplay = document.getElementById("sdScore");
const sdPopup = document.getElementById("sdPopup");
const sdFinalScore = document.getElementById("sdFinalScore");
const sdRestart = document.getElementById("sdRestart");

// Load Question
function loadSDQuestion() {
  const q = sdQuestions[sdIndex];
  sdQuestion.textContent = q.q;
  sdOptions.innerHTML = "";

  q.options.forEach((opt, i) => {
    const btn = document.createElement("button");
    btn.className = "w-full p-3 bg-gray-100 rounded-lg hover:bg-gray-200";
    btn.textContent = opt;

    btn.addEventListener("click", () => checkAnswer(i));
    sdOptions.appendChild(btn);
  });
}

// Check Answer
function checkAnswer(choice) {
  if (choice === sdQuestions[sdIndex].correct) {
    sdScore += 10;
  } else {
    sdScore -= 5;
  }

  sdScoreDisplay.textContent = sdScore;

  sdIndex++;

  if (sdIndex >= sdQuestions.length) {
    showFinalSDScore();
  } else {
    loadSDQuestion();
  }
}

// Final Score Popup
function showFinalSDScore() {
  sdFinalScore.textContent = `Your Score: ${sdScore}`;
  sdPopup.classList.remove("hidden");
}

// Restart
sdRestart.addEventListener("click", () => {
  sdIndex = 0;
  sdScore = 0;
  sdScoreDisplay.textContent = 0;
  sdPopup.classList.add("hidden");
  loadSDQuestion();
});

// Start Game
loadSDQuestion();
</script>
    <style>
  #whatsapp-button {
    position: fixed;
    bottom: 20px;
    right: 20px;
    z-index: 9999;
  }
  

  #whatsapp-button img {
    width: 60px;
    height: 60px;
    border-radius: 50%;
    box-shadow: 0 4px 6px rgba(0,0,0,0.2);
    cursor: pointer;
  }
</style>

<a href="https://wa.me/8897752518?text=Hello%20Legal%20Assist,%20I%20need%20help%20with%20your%20services" target="_blank" id="whatsapp-button">
  <img src="https://upload.wikimedia.org/wikipedia/commons/6/6b/WhatsApp.svg" alt="Chat with us on WhatsApp">
  <div class="footer">
  </main>
</body>
</html>
